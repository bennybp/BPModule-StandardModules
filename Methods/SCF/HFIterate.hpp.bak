#ifndef HFITERATE_HPP
#define HFITERATE_HPP

#include "SCF_Common.hpp"

#include <vector>
#include <pulsar/modulebase/SCFIterator.hpp>
#include <eigen3/Eigen/Dense>

namespace pulsarmethods {

class HFIterate : public pulsar::modulebase::SCFIterator
{
    public:
        HFIterate(ID_t id) :  pulsar::modulebase::SCFIterator(id), initialized_(false) { }
        
        virtual NextReturnType Next_(const pulsar::datastore::Wavefunction & wfn,
                                     const math::IrrepSpinMatrixD & fmat);

    private:
        bool initialized_;

        std::vector<double> eri_;
        double nucrep_;
        Eigen::MatrixXd S12_;
        Eigen::MatrixXd Hcore_;


        void Initialize_(const pulsar::system::System & sys, const std::string & bstag);

        double CalculateEnergy(const pulsar::math::IrrepSpinMatrixD & Dmat,
                               const BlockedEigenMatrix & Fmat);
};

}

#endif

